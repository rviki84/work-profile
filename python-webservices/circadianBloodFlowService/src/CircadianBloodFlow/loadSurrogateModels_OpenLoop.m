% Load the pre-computed simulation runs
model_params_OpenLoop = [ ...   
    0.9159    0.7477    0.7477    0.7477    0.7477    0.7477
    0.9159    0.7477    0.7477    0.7477    1.2523    1.2523
    0.9159    0.7477    0.7477    1.2523    0.7477    1.2523
    0.9159    0.7477    0.7477    1.2523    1.2523    0.7477
    0.9159    0.7477    1.2523    0.7477    0.7477    1.2523
    0.9159    0.7477    1.2523    0.7477    1.2523    0.7477
    0.9159    0.7477    1.2523    1.2523    0.7477    0.7477
    0.9159    0.7477    1.2523    1.2523    1.2523    1.2523
    0.9159    1.2523    0.7477    0.7477    0.7477    1.2523
    0.9159    1.2523    0.7477    0.7477    1.2523    0.7477
    0.9159    1.2523    0.7477    1.2523    0.7477    0.7477
    0.9159    1.2523    0.7477    1.2523    1.2523    1.2523
    0.9159    1.2523    1.2523    0.7477    0.7477    0.7477
    0.9159    1.2523    1.2523    0.7477    1.2523    1.2523
    0.9159    1.2523    1.2523    1.2523    0.7477    1.2523
    0.9159    1.2523    1.2523    1.2523    1.2523    0.7477
    1.0841    0.7477    0.7477    0.7477    0.7477    1.2523
    1.0841    0.7477    0.7477    0.7477    1.2523    0.7477
    1.0841    0.7477    0.7477    1.2523    0.7477    0.7477
    1.0841    0.7477    0.7477    1.2523    1.2523    1.2523
    1.0841    0.7477    1.2523    0.7477    0.7477    0.7477
    1.0841    0.7477    1.2523    0.7477    1.2523    1.2523
    1.0841    0.7477    1.2523    1.2523    0.7477    1.2523
    1.0841    0.7477    1.2523    1.2523    1.2523    0.7477
    1.0841    1.2523    0.7477    0.7477    0.7477    0.7477
    1.0841    1.2523    0.7477    0.7477    1.2523    1.2523
    1.0841    1.2523    0.7477    1.2523    0.7477    1.2523
    1.0841    1.2523    0.7477    1.2523    1.2523    0.7477
    1.0841    1.2523    1.2523    0.7477    0.7477    1.2523
    1.0841    1.2523    1.2523    0.7477    1.2523    0.7477
    1.0841    1.2523    1.2523    1.2523    0.7477    0.7477
    1.0841    1.2523    1.2523    1.2523    1.2523    1.2523
    0.8000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.2000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    0.4000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.6000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    0.4000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.6000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    0.4000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.6000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    0.4000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.6000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.6000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000
    1.0000    1.0000    1.0000    1.0000    1.0000    1.0000];

model_outputs_OpenLoop = [ ...
   70.9400  116.9276   56.0798    0.6166  123.0609
   83.3084  119.6594   93.9202    0.4699  110.8271
   86.6089  114.5697   93.9202    0.5473  106.6230
   68.2030  100.4801   56.0798    0.5830  118.5264
   87.2153  142.0300   93.9202    0.4924  117.2146
   68.4037  125.3322   56.0798    0.5449  122.8605
   73.7333  121.5226   56.0798    0.6312  124.3079
   83.4624  117.6590   93.9202    0.4824  106.5116
   88.8049  122.3727   93.9202    0.5123  104.7557
   70.8510  106.5231   56.0798    0.5620  113.8128
   75.6596  105.1206   56.0798    0.6399  114.8558
   81.0864  101.6551   93.9202    0.4805   96.7724
   75.1818  128.4505   56.0798    0.5908  120.3577
   81.9413  123.0628   93.9202    0.4423  105.8282
   88.9935  120.3512   93.9202    0.5274   99.8412
   70.3594  105.9019   56.0798    0.5703  112.3611
  107.6479  156.0833   93.9202    0.5200  145.2991
   77.1108  127.5607   56.0798    0.5825  147.2945
   84.3272  129.4350   56.0798    0.6593  156.4371
  101.7540  135.6529   93.9202    0.5283  139.7954
   81.9034  155.3551   56.0798    0.5955  154.8100
   99.3606  161.8092   93.9202    0.4644  146.5401
  112.6573  162.9033   93.9202    0.5554  147.1459
   83.5106  138.2874   56.0798    0.6034  153.4008
   85.8777  132.4118   56.0798    0.6259  145.6029
  101.3117  140.2305   93.9202    0.4855  134.6013
  105.5245  135.7932   93.9202    0.5699  132.4168
   84.9878  119.0054   56.0798    0.6138  143.9646
  104.3039  161.6369   93.9202    0.4967  141.4258
   82.9280  142.6107   56.0798    0.5586  146.9316
   91.8648  142.4272   56.0798    0.6474  150.8657
  103.0455  141.4597   93.9202    0.5095  132.4153
   65.2649   92.9671   75.0000    0.5142   84.5252
  106.6637  158.5166   75.0000    0.5763  164.3673
   78.8222  137.8551   75.0000    0.5562  140.1082
   89.4081  124.8946   75.0000    0.5538  119.9902
   88.3080  112.6577   75.0000    0.5808  126.9269
   93.7344  150.4944   75.0000    0.5403  134.3830
   66.4520  126.1901   75.0000    0.4067  114.3104
   88.3773  119.0404   75.0000    0.5765  122.3356
   95.9369  142.7968   75.0000    0.6152  134.4754
   84.3990  122.1648   75.0000    0.5035  125.6136
  105.6474  141.9496  120.0000    0.4658  119.0599
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907
   90.4751  132.9173   75.0000    0.5616  130.2907];

n = size(model_outputs_OpenLoop,1);
 
% Fit five multiple regression models

warning off
indsValid = find((model_outputs_OpenLoop(1:n,1) > 0) & ~isnan(model_outputs_OpenLoop(1:n,3)));
disp('Fitting for the Diastolic BP...')
mdl1_OpenLoop = LinearModel.fit([model_params_OpenLoop(indsValid ,:) model_params_OpenLoop(indsValid ,:).^2], model_outputs_OpenLoop(indsValid,1));
%mdl1_OpenLoop = LinearModel.fit(model_params_OpenLoop(indsValid ,:), model_outputs_OpenLoop(indsValid,1))
disp('--------------------------------------------')

disp('Fitting for the Systolic BP...')
mdl2_OpenLoop = LinearModel.fit([model_params_OpenLoop(indsValid ,:) model_params_OpenLoop(indsValid ,:).^2], model_outputs_OpenLoop(indsValid,2));
%mdl2_OpenLoop = LinearModel.fit(model_params_OpenLoop(indsValid ,:), model_outputs_OpenLoop(indsValid,2))
disp('--------------------------------------------')

disp('Fitting for the Heart Rate...')
mdl3_OpenLoop = LinearModel.fit([model_params_OpenLoop(indsValid ,:) model_params_OpenLoop(indsValid ,:).^2], model_outputs_OpenLoop(indsValid,3));
%mdl3_OpenLoop = LinearModel.fit(model_params_OpenLoop(indsValid ,:), model_outputs_OpenLoop(indsValid,3))
disp('--------------------------------------------')

disp('Fitting for the Ejection Fraction...')
mdl4_OpenLoop = LinearModel.fit([model_params_OpenLoop(indsValid ,:) model_params_OpenLoop(indsValid ,:).^2], model_outputs_OpenLoop(indsValid,4));
%mdl4_OpenLoop = LinearModel.fit(model_params_OpenLoop(indsValid ,:), model_outputs_OpenLoop(indsValid,4))
disp('--------------------------------------------')

disp('Fitting for the LV Volume...')
mdl5_OpenLoop = LinearModel.fit([model_params_OpenLoop(indsValid ,:) model_params_OpenLoop(indsValid ,:).^2], model_outputs_OpenLoop(indsValid,5));
%mdl5_OpenLoop = LinearModel.fit(model_params_OpenLoop(indsValid ,:), model_outputs_OpenLoop(indsValid,5))
disp('--------------------------------------------')
warning on

% Save the surrogate model for further processing
save mdl1_OpenLoop mdl1_OpenLoop
save mdl2_OpenLoop mdl2_OpenLoop
save mdl3_OpenLoop mdl3_OpenLoop
save mdl4_OpenLoop mdl4_OpenLoop
save mdl5_OpenLoop mdl5_OpenLoop